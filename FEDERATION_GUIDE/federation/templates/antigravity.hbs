{{!--
  Google Antigravity Template
  Generates multiple files for .agent/ directory:
  - rules/*.md - Workspace rules by category
  - workflows/*.md - On-demand /commands
  - skills/*.md - Modular capabilities
--}}

{{!-- ============================================================ --}}
{{!-- RULES: Main Project Identity                                  --}}
{{!-- ============================================================ --}}
{{{fileStart "rules/identity.md"}}}
<!-- Auto-generated by Federated Context System. Do not edit manually. -->
<!-- Generated: {{metadata.timestamp}} | Source: {{metadata.source}} -->

# {{registry.name}} - Project Identity

## Overview

- **Repository:** {{registry.submodule}}
- **Description:** {{registry.description}}
- **Tech Stack:** {{join registry.tech_stack ", "}}
- **Primary Language:** {{registry.primary_language}}
- **Port:** {{submodule.ports.default}}

## Quick Commands

{{#each registry.commands}}
- **{{@key}}:** `{{this}}`
{{/each}}

## Architecture

**Pattern:** {{registry.architecture.pattern}}

**Layers:**
{{#each registry.architecture.layers}}
- {{this}}
{{/each}}

{{#if registry.architecture.dependencies}}
**Dependencies:**
{{#each registry.architecture.dependencies}}
- **{{@key}}:** {{this}}
{{/each}}
{{/if}}

## Key Entry Points

{{#each registry.key_files.entry_points}}
- `{{this}}`
{{/each}}

## Environment Variables

**Required:**
{{#each registry.environment.required}}
- `{{this}}`
{{/each}}

{{#if registry.environment.optional}}
**Optional:**
{{#each registry.environment.optional}}
- `{{this}}`
{{/each}}
{{/if}}

## Related Services

{{#each cross_repos}}
- **{{name}}:** {{description}}
{{/each}}
{{{fileEnd}}}

{{!-- ============================================================ --}}
{{!-- RULES: Architecture Details                                   --}}
{{!-- ============================================================ --}}
{{{fileStart "rules/architecture.md"}}}
<!-- Auto-generated by Federated Context System -->

# Architecture Rules for {{registry.name}}

## Pattern: {{registry.architecture.pattern}}

{{#each registry.architecture.layers}}
### Layer {{@index}}: {{this}}
{{/each}}

## Key Files by Category

{{#if registry.key_files.api_routes}}
### API Routes
{{#each registry.key_files.api_routes}}
- `{{this}}`
{{/each}}
{{/if}}

{{#if registry.key_files.services}}
### Services
{{#each registry.key_files.services}}
- `{{this}}`
{{/each}}
{{/if}}

{{#if registry.key_files.models}}
### Models
{{#each registry.key_files.models}}
- `{{this}}`
{{/each}}
{{/if}}

{{#if registry.key_files.config}}
### Configuration
{{#each registry.key_files.config}}
- `{{this}}`
{{/each}}
{{/if}}

## External Integrations

{{#each registry.integrations.external}}
- **{{@key}}:** {{this}}
{{/each}}

## Internal Integrations

{{#each registry.integrations.internal}}
- **{{@key}}:** {{this}}
{{/each}}
{{{fileEnd}}}

{{!-- ============================================================ --}}
{{!-- RULES: Gotchas (Critical Issues)                              --}}
{{!-- ============================================================ --}}
{{{fileStart "rules/gotchas.md"}}}
<!-- Auto-generated by Federated Context System -->

# Critical Gotchas for {{registry.name}}

These are known issues and pitfalls. Review before making changes.

{{#each gotchas}}
## {{id}}: {{title}}

**Severity:** {{severity}}

**Symptom:** {{symptom}}

{{#if root_cause}}
**Root Cause:** {{root_cause}}
{{/if}}

**Fix:**
```
{{fix}}
```

{{#if prevention}}
**Prevention:**
{{#each prevention}}
- {{this}}
{{/each}}
{{/if}}

---

{{/each}}
{{{fileEnd}}}

{{!-- ============================================================ --}}
{{!-- RULES: Constraints                                            --}}
{{!-- ============================================================ --}}
{{{fileStart "rules/constraints.md"}}}
<!-- Auto-generated by Federated Context System -->

# Critical Constraints for {{registry.name}}

These rules MUST be followed. Violations may cause production issues.

{{#each registry.critical_constraints}}
{{@index}}. {{this}}
{{/each}}

## Summary

- Total Constraints: {{length registry.critical_constraints}}
- Gotchas: {{length gotchas}}
- Workflows: {{length workflows}}
{{{fileEnd}}}

{{!-- ============================================================ --}}
{{!-- RULES: Workflows Summary                                      --}}
{{!-- ============================================================ --}}
{{{fileStart "rules/workflows.md"}}}
<!-- Auto-generated by Federated Context System -->

# Available Workflows for {{registry.name}}

{{#each workflows}}
## {{name}}

**Category:** {{category}} | **Complexity:** {{complexity}}

{{description}}

{{#if entry_points}}
**Entry Points:**
{{#each (first entry_points 5)}}
- `{{endpoint}}` - {{purpose}}
{{/each}}
{{/if}}

---

{{/each}}
{{{fileEnd}}}

{{!-- ============================================================ --}}
{{!-- WORKFLOWS: Command Files                                      --}}
{{!-- ============================================================ --}}

{{!-- Generate /run command --}}
{{#if registry.commands.run}}
{{{fileStart "workflows/run.md"}}}
<!-- Auto-generated by Federated Context System -->

# /run - Start Development Server

## Command
```bash
{{registry.commands.run}}
```

## Description
Starts the {{registry.name}} development server on port {{submodule.ports.default}}.

## Prerequisites
- All dependencies installed
- Environment variables configured

## Related
- See `rules/identity.md` for full command list
{{{fileEnd}}}
{{/if}}

{{!-- Generate /test command --}}
{{#if registry.commands.test}}
{{{fileStart "workflows/test.md"}}}
<!-- Auto-generated by Federated Context System -->

# /test - Run Test Suite

## Command
```bash
{{registry.commands.test}}
```

## Description
Runs the test suite for {{registry.name}}.

## Tips
- Run before committing changes
- Check test coverage reports
{{{fileEnd}}}
{{/if}}

{{!-- Generate /migrate command --}}
{{#if registry.commands.migrate}}
{{{fileStart "workflows/migrate.md"}}}
<!-- Auto-generated by Federated Context System -->

# /migrate - Database Migrations

## Command
```bash
{{registry.commands.migrate}}
```

## Description
Applies pending database migrations.

## Warning
Always backup the database before running migrations in production.
{{{fileEnd}}}
{{/if}}

{{!-- Generate workflow-specific commands --}}
{{#each workflows}}
{{{fileStart (concat "workflows/implement-" (slugify name) ".md")}}}
<!-- Auto-generated by Federated Context System -->

# /implement-{{slugify name}} - {{name}} Implementation Guide

**Category:** {{category}} | **Complexity:** {{complexity}}

## Purpose

{{description}}

{{#if purpose}}
{{purpose}}
{{/if}}

## Entry Points

{{#each entry_points}}
### {{endpoint}}

- **Method:** {{method}}
- **File:** `{{file}}`
- **Purpose:** {{purpose}}

{{/each}}

{{#if call_chain}}
## Call Chain

```
{{call_chain}}
```
{{/if}}

## Related Files

{{#each ../registry.key_files.entry_points}}
- `{{this}}`
{{/each}}

## Gotchas to Watch

{{#each ../gotchas}}
{{#ifEquals category (uppercase ../category)}}
- **{{id}}**: {{title}}
{{/ifEquals}}
{{/each}}
{{{fileEnd}}}
{{/each}}

{{!-- ============================================================ --}}
{{!-- SKILLS: Modular Capabilities                                  --}}
{{!-- ============================================================ --}}

{{{fileStart "skills/debugging.md"}}}
<!-- Auto-generated by Federated Context System -->

# Debugging Skill for {{registry.name}}

## When to Use
Activate this skill when debugging issues in {{registry.name}}.

## Known Issues

{{#each gotchas}}
### {{id}}: {{title}}

**Severity:** {{severity}}

**Symptom:** {{symptom}}

**Quick Fix:**
```
{{truncate fix 200}}
```

{{/each}}

## Debug Commands

```bash
# Check service status
{{#if registry.commands.run}}
{{registry.commands.run}}
{{/if}}

# Run tests
{{#if registry.commands.test}}
{{registry.commands.test}}
{{/if}}
```

## Logging Locations

- Check application logs for errors
- Review stack traces carefully
- Verify environment configuration
{{{fileEnd}}}

{{{fileStart "skills/implementation.md"}}}
<!-- Auto-generated by Federated Context System -->

# Implementation Skill for {{registry.name}}

## When to Use
Activate this skill when implementing new features in {{registry.name}}.

## Architecture Overview

**Pattern:** {{registry.architecture.pattern}}

**Layers:**
{{#each registry.architecture.layers}}
- {{this}}
{{/each}}

## Code Standards

1. Follow existing patterns in the codebase
2. Add tests for new functionality
3. Update documentation as needed
4. Review gotchas before modifying critical areas

## Key Files to Reference

{{#each registry.key_files.entry_points}}
- `{{this}}`
{{/each}}

## Constraints to Follow

{{#each registry.critical_constraints}}
- {{this}}
{{/each}}

## Integration Points

{{#each registry.integrations.external}}
- **{{@key}}:** {{this}}
{{/each}}
{{{fileEnd}}}

{{!-- Active Task Skill (if dispatched) --}}
{{#if active_task}}
{{{fileStart "skills/current-task.md"}}}
<!-- Auto-generated by Federated Context System -->

# Current Task: {{active_task.title}}

**ID:** {{active_task.id}}
**Priority:** {{active_task.priority}}
**Status:** {{active_task.status}}

## Description

{{active_task.description}}

{{#if active_task.constraints}}
## Constraints

{{#each active_task.constraints}}
- {{this}}
{{/each}}
{{/if}}

{{#if active_task.acceptance_criteria}}
## Acceptance Criteria

{{#each active_task.acceptance_criteria}}
- [ ] {{this}}
{{/each}}
{{/if}}

{{#if active_task.related_workflows}}
## Related Workflows

{{#each active_task.related_workflows}}
- {{this}}
{{/each}}
{{/if}}

{{#if active_task.related_gotchas}}
## Related Gotchas

{{#each active_task.related_gotchas}}
- {{this}}
{{/each}}
{{/if}}
{{{fileEnd}}}
{{/if}}
