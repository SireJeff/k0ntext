{
  "$schema": "../../schemas/registry.schema.json",
  "submodule": "DLKFTD-2",
  "name": "Chat Frontend",
  "description": "AI chat interface with streaming responses",
  "tech_stack": ["Next.js 15", "React 19", "TypeScript", "SSE Streaming", "Tailwind CSS"],
  "primary_language": "typescript",
  "workflows": {
    "owned": [],
    "participates_in": [
      "user-authentication",
      "ai-gateway",
      "data-processing",
      "configuration"
    ],
    "cross_repo_dependencies": {
      "user-authentication": {
        "repo": "DLKBKD",
        "relationship": "consumer",
        "endpoints_used": [
          "/api/v1/auth/init",
          "/api/internal/auth/introspect"
        ]
      },
      "ai-gateway": {
        "repo": "synap5e",
        "relationship": "consumer",
        "endpoints_used": [
          "/v1/chat/completions",
          "/v1/presets"
        ]
      },
      "data-processing": {
        "repo": "DLKBKD",
        "relationship": "consumer",
        "endpoints_used": [
          "/api/v1/conversations/create",
          "/api/v1/conversations/history",
          "/api/v1/tokens/deduct"
        ]
      }
    }
  },
  "gotchas": {
    "directly_applicable": [
      "FE-001",
      "DEPLOY-003"
    ],
    "awareness_only": [
      "AUTH-001",
      "AUTH-002",
      "AI-001",
      "AI-002",
      "AI-003",
      "AI-006"
    ]
  },
  "key_files": {
    "entry_points": [
      "app/page.tsx",
      "app/layout.tsx"
    ],
    "pages": [
      "app/chat/page.tsx",
      "app/chat/[id]/page.tsx",
      "app/assignment/page.tsx"
    ],
    "components": [
      "components/chat/ChatInput.tsx",
      "components/chat/ChatMessage.tsx",
      "components/chat/ChatSidebar.tsx",
      "components/chat/StreamingMessage.tsx"
    ],
    "lib": [
      "lib/api/synap5e.ts",
      "lib/api/dlkbkd.ts",
      "lib/auth/token-gate.ts",
      "lib/hooks/useChat.ts",
      "lib/hooks/useStreaming.ts"
    ],
    "config": [
      "next.config.js",
      "tailwind.config.ts"
    ]
  },
  "architecture": {
    "pattern": "app-router",
    "layers": [
      "app/ - Next.js App Router pages",
      "components/chat/ - Chat UI components",
      "lib/ - API clients, hooks, utilities"
    ],
    "dependencies": {
      "backend": "DLKBKD for auth and conversation storage",
      "ai": "synap5e for streaming chat"
    }
  },
  "streaming": {
    "protocol": "Server-Sent Events (SSE)",
    "client": "lib/api/synap5e.ts",
    "format": "OpenAI-compatible delta chunks",
    "notes": [
      "Persian responses buffer before display (translation mode)",
      "Guest users limited to 10 messages per 24h"
    ]
  },
  "integrations": {
    "external": [],
    "internal": [
      {
        "name": "synap5e",
        "file": "lib/api/synap5e.ts",
        "purpose": "Streaming AI chat"
      },
      {
        "name": "DLKBKD",
        "file": "lib/api/dlkbkd.ts",
        "purpose": "Auth, conversations, tokens"
      }
    ]
  },
  "commands": {
    "dev": "npm run dev",
    "build": "npm run build",
    "start": "npm start"
  },
  "environment": {
    "required": [
      "NEXT_PUBLIC_SYNAPSE_URL",
      "NEXT_PUBLIC_API_URL"
    ],
    "optional": [
      "NEXT_PUBLIC_GUEST_MESSAGE_LIMIT",
      "INTERNAL_API_URL",
      "INTERNAL_SYNAPSE_URL"
    ]
  },
  "critical_constraints": [
    "Uses cookie auth shared with DLKFTD-1 on .deadlinekiller.com",
    "Token gate enforces balance check before chat",
    "RTL layout for Persian - code blocks need dir='ltr'",
    "Persian responses appear non-streaming (translation buffering)",
    "Guest message limit must match backend (currently 10)"
  ]
}
