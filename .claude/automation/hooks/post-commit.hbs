#!/bin/bash
# Post-commit hook for AI context sync
# This hook triggers sync after successful commits

# Don't block commit if this fails
set +e

# Check if ai-context binary is available
if ! command -v create-ai-context &> /dev/null; then
    # Try npx
    if command -v npx &> /dev/null; then
        AI_CONTEXT_CMD="npx create-universal-ai-context"
    else
        exit 0
    fi
else
    AI_CONTEXT_CMD="create-ai-context"
fi

# Run background sync (async)
echo "Syncing AI contexts in background..."

# Use subshell to run in background
(
    sleep 2  # Wait a bit to not interfere with commit
    $AI_CONTEXT_CMD sync:all --quiet > /dev/null 2>&1
) &

exit 0
